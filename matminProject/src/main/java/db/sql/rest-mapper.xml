<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

	<entry key="searchKeywordList">
		SELECT
		       REST_NO
		     , REST_NAME
		     , REST_AVG
		     , NVL(HEART,0) "HEART"
             , REST_IMG_URL
		  FROM (
		        SELECT
		               REST_NO
		             , REST_NAME
		             , AVG(REVIEW_AVG) "REST_AVG"
                     , REST_IMG_URL
		          FROM (
		               SELECT
		                      REST_NO
		                    , REST_NAME
		                    , NVL(ROUND((RATE_TASTE + RATE_PRICE + RATE_SERVICE)/3, 1), 0) AS "REVIEW_AVG"
                            , REST_IMG_URL
		                 FROM REST
		                 LEFT JOIN REVIEW USING(REST_NO)
		               )
		         GROUP
		            BY REST_NO
		             , REST_NAME
                     , REST_IMG_URL
		        )
		  LEFT JOIN (
		            SELECT
		                   REST_NO
		                 , COUNT(*) "HEART"
		              FROM HEART
		             GROUP
		                BY REST_NO
		            ) USING(REST_NO)
		 WHERE REST_NAME LIKE '%' || ? || '%'
		 ORDER
		    BY REST_NO
	</entry>

	<entry key="selectRestList">
		SELECT
		       REST_NO
		     , REST_NAME
		     , ROUND(AVG(REVIEW_AVG), 1) "REST_AVG"
		     , REST_IMG_URL
		     , LOCAL_NAME
		     , COUNT(REVIEW_NO) AS REVIEW_COUNT
		  FROM (
		       SELECT
		              REST_NO
		            , REST_NAME
		            , NVL(ROUND(REVIEW_RATE, 1), 0) AS "REVIEW_AVG"
		            , REST_IMG_URL
		            , LOCAL_NAME
		            , REVIEW_NO
		         FROM REST
		         LEFT JOIN REVIEW USING(REST_NO)
		         JOIN LOCATION ON (REST_LOCAL_ID = LOCAL_ID)
		       )
		 GROUP
		    BY REST_NO
		     , REST_NAME
		     , REST_IMG_URL
		     , LOCAL_NAME
		HAVING LOCAL_NAME = ?
		 ORDER
		    BY REST_AVG DESC , REVIEW_COUNT DESC
	</entry>

	<entry key="selectAllRestList">
		SELECT  
			REST_NO
			,REST_LOCAL_ID
			,REST_NAME
			,CTG_ID
			,REST_ADDRESS
			,REST_TEL
			,REST_GRADE
		FROM REST
			WHERE REST_STATUS = 'Y'
				
		</entry>
	
		<entry key="selectRestCount">
		SELECT 
			COUNT(*) count
			FROM REST
		WHERE REST_STATUS = 'Y'
		
		</entry>
		
		<entry key="selectBannerRestList">
		 	<![CDATA[
				SELECT
				       REST_NO
				     , REST_NAME
				     , ROUND(AVG(REVIEW_AVG), 1) "REST_AVG"
				     , REST_IMG_URL
				     , COUNT(REVIEW_NO) AS REVIEW_COUNT
				     , MENU_PRICE
				     , REP_MENU
				  FROM (
				       SELECT
				              REST_NO
				            , REST_NAME
				            , NVL(ROUND((RATE_TASTE + RATE_PRICE + RATE_SERVICE)/3, 1), 0) AS "REVIEW_AVG"
				            , REST_IMG_URL
				            , REVIEW_NO
				            , MENU_NO
				            , MENU_PRICE
				            , MENU_NAME
				            , REP_MENU
				         FROM REVIEW
				         RIGHT JOIN REST USING(REST_NO)
				         LEFT JOIN MENU USING(REST_NO)
				        WHERE REP_MENU = 'Y'
				       )
				 WHERE (
					        ( ? = 'ban_btn1' AND MENU_PRICE <= 7000 ) OR
					        ( ? = 'ban_btn2' AND MENU_PRICE > 7000 AND MENU_PRICE <= 12000 ) OR
					        ( ? = 'ban_btn3' AND MENU_PRICE > 12000 AND MENU_PRICE <= 20000) OR
					        ( ? = 'ban_btn4' AND MENU_PRICE > 20000 AND MENU_PRICE <= 35000) OR
					        ( ? = 'ban_btn5' AND MENU_PRICE > 35000)
					   )
				 GROUP
				    BY REST_NO
				     , REST_NAME
				     , REST_IMG_URL
				     , MENU_PRICE
				     , REP_MENU
				 ORDER
				    BY REST_AVG DESC , REVIEW_COUNT DESC
	     	]]>
		</entry>

		<entry key="selectCategoryList">
		
		SELECT 
		    CTG_ID
		    ,CTG_NAME
		FROM CATEGORY
		
		</entry>
		
		<entry key="insertRest">
		INSERT 
			INTO REST
			(
			REST_NO
			,REST_NAME
			,CTG_ID
			,REST_ADDRESS
			,REST_TEL
			,REST_PARKING			
			)
			VALUES
			(
			SEQ_RNO.NEXTVAL
			,?
			,?
			,?
			,?
			,?
					
			)
		
		</entry>


		<!-- 식당상세테이블용 -->
		<entry key="selectRestDetail">
		SELECT
		        REST_NO
		      , LOCAL_NAME
		      , REST_NAME
		      , CTG_NAME
		      , REST_ADDRESS
		      , REST_TEL
		      , REST_X
		      , REST_Y
		      , REST_PARKING
		      , REST_GRADE
		      , REST_TIME
		      , REST_AVG
		      , MENU_NAME
		      , TO_CHAR(MENU_PRICE, 'FM999,999') "MENU_PRICE"
		      , DT
		      , ANIMAL
		      , ROOM
		      , BIG_ROOM
		   FROM REST
		   JOIN LOCATION ON (LOCAL_ID = REST_LOCAL_ID)
		   JOIN CATEGORY USING (CTG_ID)
		   JOIN MENU USING (REST_NO)
		  WHERE REST_NO = ?
		</entry>
		
		<entry key="rsRecommend">
			SELECT 
			       REST_NO
			     , REST_NAME
			     , NVL(REST_IMG_URL, '등록된 사진이 없습니다.') "REST_IMG_URL"
			     , CTG_ID
			     , CTG_NAME
			  FROM REST
			  JOIN CATEGORY USING (CTG_ID)
			 WHERE CTG_NAME LIKE '%'|| ? ||'%'
		</entry>
</properties>