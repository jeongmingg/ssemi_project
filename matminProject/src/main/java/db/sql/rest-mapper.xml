<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

	<entry key="searchKeywordList">
		SELECT
		       REST_NO
		     , REST_NAME
		     , NVL(ROUND(REST_AVG, 1), 0) "REST_AVG"
		     , NVL(HEART,0) "HEART"
		     , REST_IMG_URL
		     , REST_ADDRESS
		     , LOCAL_NAME
		     , MENU_NAME
		     , REVIEW_COUNT
		     , REP_MENU
		  FROM (
		        SELECT
		               REST_NO
		             , REST_NAME
		             , AVG(REVIEW_AVG) "REST_AVG"
		             , REST_IMG_URL
		             , REST_ADDRESS
		             , LOCAL_NAME
		             , MENU_NAME
		             , REP_MENU
		          FROM (
		               SELECT
		                      REST_NO
		                    , REST_NAME
		                    , NVL(ROUND(REVIEW_RATE, 1), 0) AS "REVIEW_AVG"
		                    , REST_IMG_URL
		                    , REST_ADDRESS
		                    , LOCAL_NAME
		                    , MENU_NAME
		                    , REP_MENU
		                 FROM REST
		                 LEFT JOIN REVIEW USING(REST_NO)
		                 JOIN LOCATION ON (LOCAL_ID = REST_LOCAL_ID)
		                 LEFT JOIN MENU USING(REST_NO)
		               )
		         GROUP
		            BY REST_NO
		             , REST_NAME
		             , REST_IMG_URL
		             , REST_ADDRESS
		             , LOCAL_NAME
		             , MENU_NAME
		             , REP_MENU
		        )
		  LEFT JOIN (
		            SELECT
		                   REST_NO
		                 , COUNT(*) "HEART"
		              FROM HEART
		             GROUP
		                BY REST_NO
		            ) USING(REST_NO)
		  LEFT JOIN (
		            SELECT
		                   REST_NO
		                 , COUNT(*) "REVIEW_COUNT"
		              FROM REVIEW
		             GROUP
		                BY REST_NO
		            ) USING(REST_NO)           
		 WHERE REST_NAME LIKE '%' || ? || '%'
		    OR LOCAL_NAME LIKE '%' || ? || '%'
		    OR MENU_NAME LIKE '%' || ? || '%'
		
		 ORDER
		    BY REST_AVG DESC, REVIEW_COUNT DESC
	</entry>

	<entry key="selectRestList">
		SELECT
		       REST_NO
		     , REST_NAME
		     , ROUND(AVG(REVIEW_AVG), 1) "REST_AVG"
		     , REST_IMG_URL
		     , LOCAL_NAME
		     , COUNT(REVIEW_NO) AS REVIEW_COUNT
		  FROM (
		       SELECT
		              REST_NO
		            , REST_NAME
		            , NVL(ROUND(REVIEW_RATE, 1), 0) AS "REVIEW_AVG"
		            , REST_IMG_URL
		            , LOCAL_NAME
		            , REVIEW_NO
		         FROM REST
		         LEFT JOIN REVIEW USING(REST_NO)
		         JOIN LOCATION ON (REST_LOCAL_ID = LOCAL_ID)
		       )
		 GROUP
		    BY REST_NO
		     , REST_NAME
		     , REST_IMG_URL
		     , LOCAL_NAME
		HAVING LOCAL_NAME = ?
		 ORDER
		    BY REST_AVG DESC , REVIEW_COUNT DESC
	</entry>

	<entry key="selectAllRestList">
		SELECT *
    FROM (
        SELECT ROWNUM RNUM , A.*
        FROM(
        SELECT
            REST_NO
            ,LOCAL_NAME
            ,REST_NAME
            ,CTG_NAME
            ,REST_ADDRESS
            ,REST_TEL
            ,REST_AVG
        FROM REST R
        JOIN LOCATION ON (REST_LOCAL_ID = LOCAL_ID)
        JOIN CATEGORY USING (CTG_ID)
        WHERE R.REST_STATUS = 'Y'
            ) A
            )
            WHERE RNUM BETWEEN ? AND ?
		
		</entry>
	
		<entry key="selectRestCount">
		SELECT 
			COUNT(*) count
			FROM REST
		WHERE REST_STATUS = 'Y'
		
		</entry>
		
		<entry key="selectBannerRestList">
		 	<![CDATA[
				SELECT
				       REST_NO
				     , REST_NAME
				     , ROUND(AVG(REVIEW_AVG), 1) "REST_AVG"
				     , REST_IMG_URL
				     , COUNT(REVIEW_NO) AS REVIEW_COUNT
				     , MENU_PRICE
				     , REP_MENU
				  FROM (
				       SELECT
				              REST_NO
				            , REST_NAME
				            , NVL(ROUND(REVIEW_RATE, 1), 0) AS "REVIEW_AVG"
				            , REST_IMG_URL
				            , REVIEW_NO
				            , MENU_NO
				            , MENU_PRICE
				            , MENU_NAME
				            , REP_MENU
				         FROM REVIEW
				         RIGHT JOIN REST USING(REST_NO)
				         LEFT JOIN MENU USING(REST_NO)
				        WHERE REP_MENU = 'Y'
				       )
				 WHERE (
					        ( ? = 'ban_btn1' AND MENU_PRICE <= 7000 ) OR
					        ( ? = 'ban_btn2' AND MENU_PRICE > 7000 AND MENU_PRICE <= 12000 ) OR
					        ( ? = 'ban_btn3' AND MENU_PRICE > 12000 AND MENU_PRICE <= 20000) OR
					        ( ? = 'ban_btn4' AND MENU_PRICE > 20000 AND MENU_PRICE <= 35000) OR
					        ( ? = 'ban_btn5' AND MENU_PRICE > 35000)
					   )
				 GROUP
				    BY REST_NO
				     , REST_NAME
				     , REST_IMG_URL
				     , MENU_PRICE
				     , REP_MENU
				 ORDER
				    BY REST_AVG DESC , REVIEW_COUNT DESC
	     	]]>
		</entry>

		<entry key="selectCategoryList">
		
		SELECT 
		    CTG_ID
		    ,CTG_NAME
		FROM CATEGORY
		
		</entry>
		
		<entry key="insertRest">
		INSERT 
			INTO REST
			(
			REST_NO
			,REST_LOCAL_ID
			,REST_NAME
			,CTG_ID
			,REST_ADDRESS
			,REST_TEL
			,REST_PARKING
			,REST_TIME
			,DT
			,ANIMAL
			,ROOM
			,BIG_ROOM			
			)
			VALUES
			(
			'R'||SEQ_RNO.NEXTVAL
			,?
			,?
			,?
			,?
			,?
			,?
			,?
			,?
			,?
			,?
			,?
					
			)
		
		</entry>


		<!-- 식당상세테이블용 -->
		 <entry key="selectRestDetail">
		  SELECT
		       R.REST_NO
		     , REST_NAME
		     , REST_ADDRESS
		     , REST_TEL
		     , REST_PARKING
		     , REST_GRADE
		     , REST_TIME
		     , REST_AVG
		     , REST_IMG_URL
		     , DT
		     , ANIMAL
		     , ROOM
		     , BIG_ROOM
		     , LOCAL_NAME
		     , CTG_NAME
		     , COUNT(REVIEW_NO) "REVIEW_COUNT"
		  FROM REST R
		  JOIN LOCATION ON (REST_LOCAL_ID = LOCAL_ID)
		  JOIN CATEGORY USING(CTG_ID)
		  LEFT JOIN REVIEW RV ON (R.REST_NO = RV.REST_NO AND REVIEW_STATUS = 'Y')
		 WHERE R.REST_NO = ?
		   AND REST_STATUS = 'Y'
		 GROUP
		    BY R.REST_NO
		     , REST_NAME
		     , REST_ADDRESS
		     , REST_TEL
		     , REST_X
		     , REST_Y
		     , REST_PARKING
		     , REST_GRADE
		     , REST_TIME
		     , REST_AVG
		     , REST_IMG_URL
		     , DT
		     , ANIMAL
		     , ROOM
		     , BIG_ROOM
		     , LOCAL_NAME
		     , CTG_NAME
      </entry>
		
		<entry key="rsRecommend">
			SELECT 
			       REST_NO
			     , REST_NAME
			     , REST_IMG_URL
			     , CTG_ID
			     , CTG_NAME
			  FROM REST
			  JOIN CATEGORY USING (CTG_ID)
			 WHERE CTG_NAME LIKE '%'|| ? ||'%'
		</entry>
		
		<entry key="locationSearch">
			SELECT
			       REST_NO
			     , REST_NAME
			     , NVL(ROUND(REST_AVG, 1), 0) "REST_AVG"
			     , NVL(HEART,0) "HEART"
			     , REST_IMG_URL
			     , REST_ADDRESS
			     , LOCAL_NAME
			     , MENU_NAME
			     , REVIEW_COUNT
			     , REP_MENU
			     , CTG_NAME
			  FROM (
			        SELECT
			               REST_NO
			             , REST_NAME
			             , AVG(REVIEW_AVG) "REST_AVG"
			             , REST_IMG_URL
			             , REST_ADDRESS
			             , LOCAL_NAME
			             , MENU_NAME
			             , REP_MENU
			             , CTG_NAME
			          FROM (
			               SELECT
			                      REST_NO
			                    , REST_NAME
			                    , NVL(ROUND(REVIEW_RATE, 1), 0) AS "REVIEW_AVG"
			                    , REST_IMG_URL
			                    , REST_ADDRESS
			                    , LOCAL_NAME
			                    , MENU_NAME
			                    , REP_MENU
			                    , CTG_NAME
			                 FROM REST
			                 LEFT JOIN REVIEW USING(REST_NO)
			                 JOIN LOCATION ON (LOCAL_ID = REST_LOCAL_ID)
			                 LEFT JOIN MENU USING(REST_NO)
			                 JOIN CATEGORY USING(CTG_ID)
			               )
			         GROUP
			            BY REST_NO
			             , REST_NAME
			             , REST_IMG_URL
			             , REST_ADDRESS
			             , LOCAL_NAME
			             , MENU_NAME
			             , REP_MENU
			             , CTG_NAME
			        )
			  LEFT JOIN (
			            SELECT
			                   REST_NO
			                 , COUNT(*) "HEART"
			              FROM HEART
			             GROUP
			                BY REST_NO
			            ) USING(REST_NO)
			  LEFT JOIN (
			            SELECT
			                   REST_NO
			                 , COUNT(*) "REVIEW_COUNT"
			              FROM REVIEW
			             GROUP
			                BY REST_NO
			            ) USING(REST_NO)           
			 WHERE (
			         REST_NAME LIKE '%' || ? || '%'
			         OR LOCAL_NAME LIKE '%' || ? || '%'
			         OR MENU_NAME LIKE '%' || ? || '%'
			       )
			AND LOCAL_NAME LIKE '%' || ? || '%'
			AND CTG_NAME LIKE '%' || ? || '%'
			 ORDER
			    BY REST_AVG DESC, REVIEW_COUNT DESC
		</entry>
		
		<entry key="selectMenuList">
		SELECT 
			    MENU_NAME,
			    TO_CHAR(MENU_PRICE, 'FM999,999') "MENU_PRICE",
			    REP_MENU
			FROM REST
			JOIN MENU USING (REST_NO)
			WHERE REST_NO = ?
		</entry>
		
		
		
		
		<entry key="selectLocationList">
		
		SELECT 
		    LOCAL_ID
		    ,LOCAL_NAME
		FROM LOCATION
		
		</entry>
		
		<entry key="updateRest">
			UPDATE 
				REST
			  SET 
			  	REST_LOCAL_ID = ?
			  	,REST_NAME = ?
				,CTG_ID = ?
				,REST_ADDRESS = ?
				,REST_TEL = ?
				,PARKING = ?
				,REST_TIME = ?
				,ANIMAL = ?
				,ROOM = ?
				,BIG_ROOM = ?
			WHERE REST_NO = ?
		
		</entry>
		
</properties>